# 编辑器重置功能优化说明

## 问题分析

原有的编辑器重置功能存在以下问题：
1. 当编辑器进程没有完全关闭时，会出现莫名的弹框
2. 最终会报错"进程没有全部关闭"
3. 错误处理不够友好，用户体验差
4. 跨平台兼容性不够完善

## 优化方案

### 1. 后端优化 (Rust)

#### 新增进程检查命令
- 添加 `check_editor_processes` 命令，用于在重置前检查运行中的进程
- 返回运行中进程的详细列表，包括进程名和PID

#### 改进进程关闭逻辑
- **Windows平台**：
  - 先使用 `taskkill /PID xxx /T` 温和关闭
  - 失败后使用 `taskkill /PID xxx /F /T` 强制关闭
  - 增加详细的日志输出和错误处理

- **Linux/macOS平台**：
  - 先发送 SIGTERM 信号温和关闭
  - 等待2秒后检查进程是否存在
  - 如果仍存在，发送 SIGKILL 强制关闭
  - 使用 `kill -0` 检查进程状态

#### 错误处理优化
- 不再因为部分进程关闭失败就直接返回错误
- 改为返回警告信息，允许继续执行后续步骤
- 增加进程关闭后的验证检查

### 2. 前端优化 (Vue)

#### 重置前进程检查
- 在开始重置前，先调用 `check_editor_processes` 检查运行中的进程
- 如果发现运行中的进程，显示自定义确认对话框
- 列出所有运行中的进程，让用户明确知道将要关闭的进程

#### 改进的错误处理
- 每个步骤都使用 try-catch 包装，避免单个步骤失败导致整个流程中断
- 区分警告和错误，使用不同的图标和颜色显示
- 增加 `hasWarnings` 标志，当有警告时不自动关闭对话框

#### 用户体验优化
- 增加等待时间从2秒到3秒，确保进程完全关闭
- 改进状态消息显示，使用emoji图标区分成功、警告和错误
- 当有警告时，提供更详细的说明和建议

### 3. 跨平台兼容性

#### Windows
- 使用 `taskkill` 命令，支持进程树关闭 (`/T` 参数)
- 温和关闭失败时自动尝试强制关闭 (`/F` 参数)

#### Linux/macOS
- 使用标准的 `kill` 命令
- 先发送 SIGTERM，再发送 SIGKILL
- 使用 `kill -0` 检查进程状态

## 使用流程

1. 用户点击"重置Augment"按钮
2. 选择要重置的编辑器
3. 点击"开始重置"
4. 系统检查是否有运行中的编辑器进程
5. 如果有进程运行，显示确认对话框列出所有进程
6. 用户确认后开始重置流程：
   - 步骤1：关闭编辑器进程（温和→强制）
   - 步骤2：清理Augment数据库
   - 步骤3：重置遥测标识
7. 显示每个步骤的执行结果
8. 如果有警告，保持对话框打开供用户查看详情

## 错误处理策略

- **进程关闭失败**：显示警告但继续执行，建议用户手动关闭编辑器
- **数据库清理失败**：显示警告但继续执行，记录具体错误信息
- **遥测重置失败**：显示警告，记录具体错误信息
- **严重错误**：停止执行并显示错误信息

## 测试建议

1. 在编辑器运行时测试重置功能
2. 测试进程关闭失败的情况
3. 测试跨平台兼容性（Windows、macOS、Linux）
4. 测试网络异常情况下的错误处理
